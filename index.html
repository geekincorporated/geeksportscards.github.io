<!-- Back to Top Button placed just before </body> for correct DOM availability -->

<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="static/images/favicon.ico">
    <meta charset="UTF-8">
    <title>Geek Sports Cards and Collectables</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.counter.dev/script.js" data-id="18805968-c523-41d4-a5fc-6a39864fa88e"
        data-utcoffset="-6"></script>
    <link rel="stylesheet" href="static/css/site.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body id="top">

    <div class="custom-header">
        <div class="header-title" style="margin-bottom:0.08em;">
            <span class="header-geek">GEEK</span><span class="header-sports">SPORTS</span><span
                class="header-cards">CARDS <span class="collectables">& COLLECTABLES</span></span>
        </div>
        <div class="header-subtitle" style="margin-top:0;">
            <span class="header-subtitle-main">COLLECTING | BUYING | SELLING | TRADING</span>
            <span class="header-subtitle-since"> SINCE 1985</span>
        </div>
    </div>



    <div class="search-outer-container">
        <div id="customSearchContainer" class="search-input-wrapper">
            <input type="text" id="keywordSearch" placeholder="Search keywords...">
            <button type="button" id="clearSearchBtn" title="Clear search">&#10006;</button>
        </div>
    </div>



    <div class="container-main">

        <div style="display: flex;">
            <div id="sidebar">
                <nav class="side-menu" id="sideMenuLinks" style="margin-top:0;">
                    <ul>
                        <li>
                            <hr style="border:0;border-top:1px solid white;margin:0 0 10px 0;">
                        </li>
                        <li class="sidebar-filters-menu">
                            <a href="#"><i class="fa-solid fa-filter"></i> Filters</a>
                            <div class="sidebar-filters-panel">
                                <form id="filterForm">
                                    <div class="sidebar-section-title">Format</div>
                                    <div><input type="checkbox" name="filter" value="auction" id="filter_auction">
                                        <label for="filter_auction">Auction</label>
                                    </div>
                                    <div><input type="checkbox" name="filter" value="bin" id="filter_bin"> <label
                                            for="filter_bin">Buy It Now</label></div>

                                    <div class="sidebar-section-title" style="color: red;">NEW!</div>
                                    <div><input type="checkbox" name="filter" value="upcoming_auctions"
                                            id="filter_upcoming_auctions"> <label
                                            for="filter_upcoming_auctions">Upcoming Auctions</label></div>

                                    <div><input type="checkbox" name="filter" value="coming_soon"
                                            id="filter_coming_soon"> <label for="filter_coming_soon">Coming Soon (BIN)</label>
                                    </div>


                                    <div class="sidebar-section-title">Category</div>
                                    <div><input type="checkbox" name="category_filter" value="Singles"
                                            id="filter_category_singles"> <label
                                            for="filter_category_singles">Singles</label></div>
                                    <div><input type="checkbox" name="category_filter" value="Lots"
                                            id="filter_category_lots"> <label for="filter_category_lots">Lots</label>
                                    </div>
                                    <div><input type="checkbox" name="category_filter" value="Sets"
                                            id="filter_category_sets"> <label for="filter_category_sets">Sets</label>
                                    </div>

                                    <div><input type="checkbox" name="filter" value="graded" id="filter_graded"> <label
                                            for="filter_graded">Graded</label></div>
                                    <div><input type="checkbox" name="filter" value="autographed"
                                            id="filter_autographed"> <label for="filter_autographed">Autographed</label>
                                    </div>


                                    <div class="sidebar-section-title">Sport</div>
                                    <div><input type="checkbox" name="sport_filter" value="Baseball"
                                            id="filter_sport_baseball"> <label
                                            for="filter_sport_baseball">Baseball</label></div>
                                    <div><input type="checkbox" name="sport_filter" value="Basketball"
                                            id="filter_sport_basketball"> <label
                                            for="filter_sport_basketball">Basketball</label></div>
                                    <div><input type="checkbox" name="sport_filter" value="Football"
                                            id="filter_sport_football"> <label
                                            for="filter_sport_football">Football</label></div>
                                    <div><input type="checkbox" name="sport_filter" value="Hockey"
                                            id="filter_sport_hockey"> <label for="filter_sport_hockey">Hockey</label>
                                    </div>
                                    <div class="sidebar-section-title">Feature / Attribute</div>
                                    <div><input type="checkbox" name="filter" value="rookie" id="filter_rookie"> <label
                                            for="filter_rookie">Rookie Card</label></div>
                                    <div><input type="checkbox" name="filter" value="hof" id="filter_hof"> <label
                                            for="filter_hof">Hall of Fame</label></div>
                                    <div><input type="checkbox" name="filter" value="uer" id="filter_uer"> <label
                                            for="filter_uer">Uncorrected Errors</label></div>
                                    <div><input type="checkbox" name="filter" value="err" id="filter_err"> <label
                                            for="filter_err">Errors</label></div>
                                    <div><input type="checkbox" name="filter" value="cor" id="filter_cor"> <label
                                            for="filter_cor">Corrected</label></div>
                                    <div class="sidebar-section-title">Quick View</div>
                                    <div><input type="radio" name="view_filter" value="most_bids"
                                            id="filter_view_most_bids"> <label for="filter_view_most_bids">Most
                                            Bids</label></div>
                                    <div><input type="radio" name="view_filter" value="most_watchers"
                                            id="filter_view_most_watchers"> <label for="filter_view_most_watchers">Most
                                            Watchers</label></div>
                                    <div><input type="radio" name="view_filter" value="ending_today"
                                            id="filter_view_ending_today"> <label for="filter_view_ending_today">Auction
                                            Ending Today</label></div>
                                    <div><input type="radio" name="view_filter" value="ending_soonest"
                                            id="filter_view_ending_soonest"> <label
                                            for="filter_view_ending_soonest">Ending Soonest</label></div>
                                    <div><input type="radio" name="view_filter" value="most_recent"
                                            id="filter_view_most_recent"> <label for="filter_view_most_recent">Most
                                            Recent</label></div>
                                    <div><input type="radio" name="view_filter" value="highest_price"
                                            id="filter_view_highest_price"> <label
                                            for="filter_view_highest_price">Highest Price</label></div>
                                    <div><input type="radio" name="view_filter" value="lowest_price"
                                            id="filter_view_lowest_price"> <label for="filter_view_lowest_price">Lowest
                                            Price</label></div>
                                    <div class="sidebar-clear-btn"><button type="button" id="clearAllFilters" class="mobile-reset-btn">Clear Filters</button></div>
                                </form>
                            </div>
                        </li>

                        <li>
                            <hr style="border:0;border-top:1px solid white;margin:0 0 10px 0;">
                        </li>
                    </ul>
                    <div style="text-align:left;">
                        <a href="https://www.facebook.com/geeksportscards" target="_blank" rel="noopener noreferrer">
                        <img src="static/images/facebook-logo-png-30.png" alt="Facebook" style="max-width: 100%; height: auto; margin: 0; padding: 0;">
                        </a>
                        <a href="#" target="_blank" rel="noopener noreferrer">
                        <img src="static/images/cardrank-logo-png-30-1.png" alt="cardrank.ai" style="max-width: 100%; height: auto; margin: 0; padding: 0;">
                        </a>

                    </div>
                </nav>

            </div>
            <div class="main-content-flex">
                <div>
                    <div id="resultsCount"></div>
                    <div id="mobileFormatFilters" class="mobile-format-filters">
                        <div class="mobile-filters-title">Filters</div>
                        <div class="mobile-filters-options">
                            <div><input type="checkbox" name="filter" value="auction" id="mobile_filter_auction">
                                <label for="mobile_filter_auction">Auction</label>
                            </div>
                            <div><input type="checkbox" name="filter" value="bin" id="mobile_filter_bin"> <label
                                    for="mobile_filter_bin">Buy It Now</label></div>
                            <div><input type="checkbox" name="filter" value="upcoming_auctions"
                                    id="mobile_filter_upcoming_auctions"> <label
                                    for="mobile_filter_upcoming_auctions">Upcoming Auctions</label></div>
                            <div><input type="checkbox" name="filter" value="coming_soon"
                                    id="mobile_filter_coming_soon"> <label for="mobile_filter_coming_soon">Coming Soon</label>
                            </div>
                        </div>
                        <button id="mobileResetBtn" class="mobile-reset-btn">Clear Filters</button>
                    </div>
                </div>
                <div id="itemsGrid"></div>
                <!-- Message shown only for very small screens (<=499px). Hidden by default, revealed via CSS -->
                <div class="small-screen-message" aria-hidden="true" style="display:none;">
                    <div class="small-screen-inner">
                        <h4>Screen too small</h4>
                        <p>For the best experience please use a device with a wider screen (minimum 500px) or rotate
                            your device.</p>
                    </div>
                </div>
            </div>
        </div>



    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>

        // Reusable affiliate helper (keeps links consistent)
        const AFFILIATE_PARAMS = 'mkcid=1&mkrid=711-53200-19255-0&siteid=0&campid=5339025312&customid=&toolid=10001&mkevt=1';
        function appendAffiliate(url) {
            if (!url || typeof url !== 'string') return url;
            try {
                if (url.includes('ebay.com')) {
                    return url + (url.includes('?') ? '&' : '?') + AFFILIATE_PARAMS;
                }
            } catch (e) {
                return url;
            }
            return url;
        }

        // Function to open image gallery modal
        let currentItemData = null;
        let imageGalleryModal = null; // Store modal instance
        
        function openImageGallery(itemId) {
            // Find the item data from the full data
            if (!window._ebayData) return;
            const itemData = window._ebayData.find(item => item.ItemID === itemId);
            if (!itemData) return;
            
            const imageUrls = [];
            
            // Check if this is a Lots or Sets category item
            const category = itemData['Category'] ? String(itemData['Category']).trim().toLowerCase() : '';
            const includePrimaryImage = (category === 'lots' || category === 'sets');
            
            // Collect all ebay Image URLs (start from 1 for lots/sets, from 2 for singles)
            const startIndex = includePrimaryImage ? 1 : 2;
            for (let i = startIndex; ; i++) {
                const url = itemData[`ebay Image URL ${i}`];
                if (url) {
                    imageUrls.push({ url: url, type: 'ebay Image', index: i });
                } else {
                    break;
                }
            }
            
            // Collect all ebay Variation Image URLs
            for (let i = 1; ; i++) {
                const url = itemData[`ebay Variation Image URL ${i}`];
                if (url) {
                    imageUrls.push({ url: url, type: 'ebay Variation Image', index: i });
                } else {
                    break;
                }
            }
            
            if (imageUrls.length === 0) {
                return; // No images to show
            }
            
            // Set main image to first available image (not ebay Image URL 1)
            const mainImageUrl = imageUrls[0].url;
            $('#mainImage').attr('src', mainImageUrl);
            
            // Create thumbnails
            let thumbnailsHtml = '';
            imageUrls.forEach((img, idx) => {
                const isActive = img.url === mainImageUrl ? 'active' : '';
                thumbnailsHtml += `<img src="${img.url}" alt="${img.type} ${img.index}" class="img-thumbnail gallery-thumb ${isActive}" style="width: 80px; height: 80px; object-fit: contain; cursor: pointer; margin: 2px;" onclick="changeMainImage('${img.url.replace(/'/g, "\\'")}')">`;
            });
            
            $('#thumbnailContainer').html(thumbnailsHtml);
            
            // Show/hide scroll buttons based on thumbnail count
            const thumbnailCount = imageUrls.length;
            if (thumbnailCount > 3) {
                $('#scrollUpBtn, #scrollDownBtn').removeClass('d-none');
                // Add scroll functionality
                $('#scrollUpBtn').off('click').on('click', function() {
                    const container = $('#thumbnailContainer')[0];
                    container.scrollBy({ top: -100, behavior: 'smooth' });
                });
                $('#scrollDownBtn').off('click').on('click', function() {
                    const container = $('#thumbnailContainer')[0];
                    container.scrollBy({ top: 100, behavior: 'smooth' });
                });
            } else {
                $('#scrollUpBtn, #scrollDownBtn').addClass('d-none');
            }
            
            // Set modal title to card name
            $('#imageGalleryModalLabel').text(itemData['Card Name'] || 'Card Images');
            
            // Create or reuse modal instance
            if (!imageGalleryModal) {
                imageGalleryModal = new bootstrap.Modal(document.getElementById('imageGalleryModal'));
            }
            imageGalleryModal.show();
        }
        
        // Function to open make offer modal for upcoming auctions
        let makeOfferModal = null; // Store modal instance
        
        function openMakeOfferForm(itemId) {
            // Find the item data from the full data
            if (!window._ebayData) return;
            const itemData = window._ebayData.find(item => item.ItemID === itemId);
            if (!itemData) return;
            
            // Pre-fill the subject with card information
            const cardName = itemData['Card Name'] || 'Card';
            const player = itemData['Player/Athlete'] || '';
            const team = itemData['Team'] || '';
            const cardNumber = itemData['Card Number'] || '';
            const subject = `Inquiry about ${cardName}${player ? ` - ${player}` : ''}${team ? ` (${team})` : ''}${cardNumber ? ` #${cardNumber}` : ''}`;
            
            $('#contactSubject').val(subject);
            
            // Create or reuse modal instance
            if (!makeOfferModal) {
                makeOfferModal = new bootstrap.Modal(document.getElementById('makeOfferModal'));
            }
            makeOfferModal.show();
        }
        
        // Function to change main image when thumbnail is clicked
        function changeMainImage(url) {
            $('#mainImage').attr('src', url);
            // Update active thumbnail
            $('.gallery-thumb').removeClass('active');
            $(`.gallery-thumb[src="${url}"]`).addClass('active');
        }


        // Show about info in main content, full width, when About link is clicked
        $(document).on('click', '.custom-footer a:contains("About")', function (e) {
            e.preventDefault();
            if (window.location.pathname !== '/about') {
                window.history.pushState({ page: 'about' }, '', '/about');
            }
            // Add cache-busting parameter to force fresh data
            const timestamp = new Date().getTime();
            $.getJSON(`static/site_content/site.json?_=${timestamp}`, function (siteData) {
                if (siteData && siteData.about) {
                    const a = siteData.about;
                    let html = `<div class='shipping-info-box'>`;
                    html += `<a href="#" id="aboutBackLink" style="display:inline-flex;align-items:center;font-size:1.35em;color:#0d6efd;text-decoration:none;margin-bottom:18px;padding-left:5px;"><i class='fas fa-arrow-circle-left' style='margin-right:10px;font-size:1.4em;'></i><span style='font-weight:bold;font-size:1.1em;'>Back</span></a>`;
                    html += `<h2 class='shipping-info-title'>About</h2>`;
                    html += `<div class='shipping-info-section' style='display:flex;align-items:flex-start;gap:16px;padding-left:5px;'>`;
                    html += `<div style='display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-width:90px;max-width:90px;'>`;
                    if (a.sellericon) {
                        html += `<img src='${a.sellericon}' alt='Seller Icon' style='max-width:90px;max-height:90px;display:block;'>`;
                    }
                    html += `</div>`;
                    html += `<div style='flex:1;display:flex;flex-direction:column;justify-content:flex-start;'>`;
                    html += `<div>${a.description || ''}</div>`;
                    if (a.ebayrating) {
                        html += `<div style='margin-top:6px;'>${a.ebayrating}</div>`;
                    }
                    html += `</div></div>`;

                    if (a.ssnicon || a.rating || a.ebayfeedbackurl) html += `
                        <div class='shipping-info-section' style='margin-bottom:10px;'>
                            <div style='font-size:1.5em;font-weight:bold;margin-bottom:8px;text-align:left;'>on 
                                <span style="color:#e53238;">e</span><span style="color:#0064d2;">B</span><span style="color:#f5af02;">a</span><span style="color:#86b817;">y</span>
                            </div>
                            <div style='display:flex;flex-direction:column;align-items:flex-start;gap:10px;'>
                                <div style='display:flex;flex-direction:row;align-items:center;justify-content:flex-start;min-width:360px;max-width:360px;margin-left:-4px;gap:5px;'>
                                    <img src='static/images/GEEKSPORTSCARDS_BIN.png' alt='BIN Icon' style='max-width:90px;max-height:90px;display:block;'>
                                    <img src='static/images/GEEKSPORTSCARDS_AUCTIONS.png' alt='Auctions Icon' style='max-width:90px;max-height:90px;display:block;'>
                                    <img src='static/images/GEEKSPORTSCARDS_SLABS.png' alt='Slabs Icon' style='max-width:90px;max-height:90px;display:block;'>
                                    <img src='static/images/GEEKSPORTSCARDS_COLLECTABLES.png' alt='Collectables Icon' style='max-width:90px;max-height:90px;display:block;'>
                                </div>
                                <div style='display:flex;flex-direction:column;align-items:flex-start;justify-content:center;text-align:left;'>
                                    <span style='font-size:1.08em;font-weight:bold;margin-bottom:2px;'>GEEK SPORTS CARDS &amp; COLLECTABLES</span>
                                    <span style='font-size:0.98em;margin-bottom:4px;'>100% Positive Seller Feedback (last 12 months)</span>
                                    <a href='https://www.ebay.com/fdbk/feedback_profile/lotsofcards-gsc' target='_blank' rel='noopener' style='color:#0d6efd;text-decoration:underline;font-weight:bold;display:inline-block;'>eBay Seller Feedback</a>
                                </div>
                            </div>
                        </div>`;
                    html += `</div>`;
                    $('#itemsGrid').html(html);
                    $('#resultsCount').html('');
                    $('.search-outer-container').hide();
                } else {
                    $('#itemsGrid').html('<div class="shipping-info-box">About information not available.</div>');
                    $('#resultsCount').html('');
                    $('.search-outer-container').show();
                }
            }).fail(function () {
                $('#itemsGrid').html('<div class="shipping-info-box">About information could not be loaded.</div>');
                $('#resultsCount').html('');
                $('.search-outer-container').show();
            });
        });

        // Show shipping info in main content, full width, when Shipping link is clicked
        $(document).on('click', '.custom-footer a:contains("Shipping")', function (e) {
            e.preventDefault();
            if (window.location.pathname !== '/shipping') {
                window.history.pushState({ page: 'shipping' }, '', '/shipping');
            }
            // Add cache-busting parameter to force fresh data
            const timestamp = new Date().getTime();
            $.getJSON(`static/site_content/site.json?_=${timestamp}`, function (siteData) {
                if (siteData && siteData.shipping) {
                    const s = siteData.shipping;
                    let html = `<div class='shipping-info-box'>`;
                    html += `<a href="#" id="shippingBackLink" style="display:inline-flex;align-items:center;font-size:1.25em;color:#0d6efd;text-decoration:none;margin-bottom:18px;padding-left:5px;"><i class='fas fa-arrow-circle-left' style='margin-right:10px;font-size:1.4em;'></i><span style='font-weight:bold;font-size:1.1em;'>Back</span></a>`;
                    html += `<h2 class='shipping-info-title'>Shipping Policy</h2>`;
                    html += `<div class='shipping-info-section'>${s.description || ''}</div>`;
                    if (s.policy) html += `<div class='shipping-info-section'>${s.policy}</div>`;

                    if (s.freeshipping) html += `<div class='shipping-info-section'><strong>Free Shipping:</strong> ${s.freeshipping}</div>`;

                    if (s.standardshipping) html += `<div class='shipping-info-section'><strong>Standard Shipping Raw / Singles:</strong> ${s.standardshipping}</div>`;

                    if (s.combinedshipping) html += `<div class='shipping-info-section'><strong>Combined Shipping Raw / Singles:</strong> ${s.combinedshipping}</div>`;

                    if (s.standardshippingslabs) html += `<div class='shipping-info-section'><strong>Standard Shipping Slabs:</strong> ${s.standardshippingslabs}</div>`;

                    if (s.lotsnsetsshipping) html += `<div class='shipping-info-section'><strong>Lots and Sets 20 Items or Less Standard Shipping:</strong> ${s.lotsnsetsshipping}</div>`;

                    if (s.lotsnsetsshipping20plus) html += `<div class='shipping-info-section'><strong>Lots and Sets More 20 Items Standard Shipping:</strong> ${s.lotsnsetsshipping20plus}</div>`;



                    if (s.shippingMethod) html += `<div class='shipping-info-section'><strong>Shipping Method:</strong> ${s.shippingMethod}</div>`;
                    if (s.ebayshippinglink) html += `<div class='shipping-info-section'><a href='${s.ebayshippinglink}' target='_blank' rel='noopener'>eBay Shipping Help</a></div>`;
                    html += `</div>`;
                    $('#itemsGrid').html(html);
                    $('#resultsCount').html('');
                    $('.search-outer-container').hide();
                } else {
                    $('#itemsGrid').html('<div class="shipping-info-box">Shipping information not available.</div>');
                    $('#resultsCount').html('');
                    $('.search-outer-container').show();
                }
            }).fail(function () {
                $('#itemsGrid').html('<div class="shipping-info-box">Shipping information could not be loaded.</div>');
                $('#resultsCount').html('');
                $('.search-outer-container').show();
            });
        });

        // Restore main content (shared by multiple back links)
        function restoreMainContent() {
            if (window.location.pathname !== '/') {
                window.history.pushState({}, '', '/');
            }
            if (window._ebayData) {
                renderList(window._ebayData);
                updateResultsCount(window._ebayData.length);
                $('.search-outer-container').show();
            } else {
                window.location.reload();
            }
        }

        // Click handlers for back links
        $(document).on('click', '#shippingBackLink', function (e) {
            e.preventDefault();
            restoreMainContent();
        });
        $(document).on('click', '#aboutBackLink', function (e) {
            e.preventDefault();
            restoreMainContent();
        });

        // Handle browser navigation for /about and /shipping - attach once
        window.addEventListener('popstate', function (event) {
            if (window.location.pathname === '/about') {
                // Only load About if not already showing
                if (!$('#itemsGrid .shipping-info-title').text().includes('About')) {
                    $('.custom-footer a:contains("About")').trigger('click');
                }
            } else if (window.location.pathname === '/shipping') {
                if (!$('#itemsGrid .shipping-info-title').text().includes('Shipping')) {
                    $('.custom-footer a:contains("Shipping")').trigger('click');
                }
            } else {
                // Restore main content if not /about or /shipping
                restoreMainContent();
            }
        });




        function updateResultsCount(count) {
            let total = 0;
            const comingSoonSelected = $('#filterForm input[type=checkbox][name=filter][value=coming_soon]:checked').length > 0;
            const upcomingAuctionsSelected = $('#filterForm input[type=checkbox][name=filter][value=upcoming_auctions]:checked').length > 0;

            if (comingSoonSelected) {
                total = window._ebayData ? window._ebayData.filter(row => row['isScheduled'] && row['Format'] && (row['Format'].toLowerCase() === 'bin' || row['Format'].toLowerCase() === 'fixedprice')).length : count;
            } else if (upcomingAuctionsSelected) {
                total = window._ebayData ? window._ebayData.filter(row => row['isScheduled'] && row['Format'] && row['Format'].toLowerCase() === 'auction').length : count;
            } else {
                total = window._ebayData ? window._ebayData.filter(row => !row['isScheduled']).length : count;
            }

            $('#resultsCount').html('<span class="results-count-text">' + count + ' of ' + total + ' matching items</span>');
        }
        function getAuctionTimeLeft(endDateStr) {
            if (!endDateStr) return '';
            let endDate = new Date(endDateStr);
            if (isNaN(endDate.getTime())) return '';
            let now = new Date();
            let diffMs = endDate - now;
            if (diffMs <= 0) return 'Ended';
            let diffSec = Math.floor(diffMs / 1000);
            let hours = Math.floor(diffSec / 3600);
            let minutes = Math.floor((diffSec % 3600) / 60);
            let days = Math.floor(hours / 24);
            let remHours = hours % 24;
            let timeLeftStr = '';
            if (days >= 1) {
                let pad = n => n.toString().padStart(2, '0');
                timeLeftStr = `${pad(days)}d:${pad(remHours)}h:${pad(minutes)}m`;
            } else {
                timeLeftStr = `${hours}h:${minutes}m`;
            }
            let endStr = '';
            if (endDate.toDateString() === now.toDateString()) {
                endStr = 'Today @ ' + endDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            } else {
                let tomorrow = new Date(now);
                tomorrow.setDate(now.getDate() + 1);
                if (endDate.toDateString() === tomorrow.toDateString()) {
                    endStr = 'Tomorrow ' + endDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                } else {
                    endStr = endDate.toLocaleDateString() + ' ' + endDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                }
            }
            return `${timeLeftStr} (${endStr})`;
        }
        function getScheduledTimeLeft(startDateStr, format) {
            if (!startDateStr) return '';
            let startDate = new Date(startDateStr);
            if (isNaN(startDate.getTime())) return '';
            let now = new Date();
            let diffMs = startDate - now;
            if (diffMs <= 0) return 'Starting Soon';
            let diffSec = Math.floor(diffMs / 1000);
            let hours = Math.floor(diffSec / 3600);
            let minutes = Math.floor((diffSec % 3600) / 60);
            let days = Math.floor(hours / 24);
            let remHours = hours % 24;
            let timeLeftStr = '';
            if (days >= 1) {
                let pad = n => n.toString().padStart(2, '0');
                timeLeftStr = `${pad(days)}:${pad(remHours)}:${pad(minutes)}`;
            } else {
                timeLeftStr = `${hours}h ${minutes}m`;
            }
            let startStr = '';
            if (startDate.toDateString() === now.toDateString()) {
                startStr = startDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            } else {
                let tomorrow = new Date(now);
                tomorrow.setDate(now.getDate() + 1);
                if (startDate.toDateString() === tomorrow.toDateString()) {
                    startStr = 'Tomorrow ' + startDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                } else {
                    startStr = startDate.toLocaleDateString() + ' ' + startDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                }
            }

            // Format differently for auctions
            if (format && format.toLowerCase() === 'auction') {
                let timeFormatted = '';
                if (days >= 1) {
                    timeFormatted = `${days}d:${remHours}h:${minutes}m`;
                } else {
                    timeFormatted = `${hours}h:${minutes}m`;
                }
                let dateFormatted = startDate.toLocaleDateString('en-US', { weekday: 'short', month: 'numeric', day: 'numeric' });
                let timeFormattedShort = startDate.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit', hour12: true });
                return `Starts On: ${dateFormatted} @ ${timeFormattedShort} (${timeFormatted})`;
            } else {
                return `Starts in ${timeLeftStr} (${startStr})`;
            }
        }
        function renderList(items) {
            $('.search-outer-container').show();
            const isMobile = window.innerWidth <= 800;
            const comingSoonSelected = $('#filterForm input[type=checkbox][name=filter][value=coming_soon]:checked').length > 0;
            const upcomingAuctionsSelected = $('#filterForm input[type=checkbox][name=filter][value=upcoming_auctions]:checked').length > 0;
            const keyword = $('#keywordSearch').val().trim();
            let className = 'card-container';
            if (comingSoonSelected || upcomingAuctionsSelected) {
                className += ' coming-soon-layout';
            }
            if (upcomingAuctionsSelected) {
                className += ' upcoming-layout';
            }
            if (keyword) {
                className += ' keyword-search-layout';
            }
            let html = `<div class="${className}">`;
            items.forEach(row => {
                const imgUrl = row['ebay Image URL 1'] && (row['ebay Image URL 1'].startsWith('http://') || row['ebay Image URL 1'].startsWith('https://'))
                    ? row['ebay Image URL 1']
                    : 'https://d3mop092koehdk.cloudfront.net/images/no-image-new.jpg';
                const isSetsCategory = row['Category'] && String(row['Category']).trim().toLowerCase() === 'sets';
                const isSetOrLot = row['Category'] && (String(row['Category']).trim().toLowerCase() === 'sets' || String(row['Category']).trim().toLowerCase() === 'lots');
                let title;
                title = row['Set Name'] || '';
                let link = row['ebay listing URL'] || '#';
                // Append affiliate params when appropriate
                link = appendAffiliate(link);
                const price = row['Current Price'] ? `$${row['Current Price']}` : '';
                let shipping = '';
                if (row['Shipping Cost'] !== undefined && row['Shipping Cost'] !== null && row['Shipping Cost'] !== '') {
                    const shipVal = parseFloat(row['Shipping Cost']);
                    if (!isNaN(shipVal) && shipVal === 0) {
                        shipping = '<span class="text-success">+ Free Shipping</span>';
                    } else {
                        shipping = `+$${row['Shipping Cost']} Shipping`;
                    }
                }
                const timeLeft = row['isScheduled'] ? getScheduledTimeLeft(row['Start Date'], row['Format']) : getAuctionTimeLeft(row['End Date']);
                let displayTime = timeLeft.replace(/\s*\([^)]*\)$/, '');
                let timeLeftColor = '';
                if (row['isScheduled']) {
                    // For scheduled items, show start date
                    if (row['Start Date']) {
                        let startDate = new Date(row['Start Date']);
                        if (!isNaN(startDate.getTime())) {
                            let now = new Date();
                            let diffMs = startDate - now;
                            if (diffMs > 0) {
                                timeLeftColor = 'blue';
                            }
                        }
                    }
                } else {
                    // For active items, show end date
                    if (row['End Date']) {
                        let endDate = new Date(row['End Date']);
                        if (!isNaN(endDate.getTime())) {
                            let now = new Date();
                            let diffMs = endDate - now;
                            if (diffMs > 24 * 60 * 60 * 1000) {
                                timeLeftColor = 'green';
                            } else if (diffMs > 0) {
                                timeLeftColor = 'red';
                            }
                        }
                    }
                }
                const itemNum = row['ItemID'] || '';
                const formatLower = row['Format'] ? String(row['Format']).trim().toLowerCase() : '';
                const bids = formatLower === 'bin'
                    ? (row['Watch Count'] ? `${row['Watch Count']} Watching` : '0 Watching')
                    : (row['Bid Count'] ? `${row['Bid Count']} ${parseInt(row['Bid Count']) === 1 ? 'Bid' : 'Bids'}` : '0 Bids');
                let quantityLabel = 'Quantity Avail:';
                let quantityValue = '';
                if (row['Variation'] == 0) {
                    quantityValue = '1';
                } else if (row['Quantity Available'] !== undefined && row['Quantity Available'] !== null && String(row['Quantity Available']).trim() !== '') {
                    quantityValue = String(row['Quantity Available']);
                } else {
                    quantityValue = '1';
                }
                if (row['CategoryID'] == '261329' || row['CategoryID'] == '261330') {
                    quantityLabel = 'Number of Cards:';
                    if (row['Number of Cards'] !== undefined && row['Number of Cards'] !== null && String(row['Number of Cards']).trim() !== '') {
                        quantityValue = String(row['Number of Cards']);
                    } else {
                        quantityValue = null;
                    }
                }
                let catDisplay = '';
                const rawCat = row['Category'] ? String(row['Category']).trim().toLowerCase() : '';
                if (rawCat === 'sets') catDisplay = 'Set';
                else if (rawCat === 'singles') catDisplay = 'Single';
                else if (rawCat === 'lots') catDisplay = 'Lot';
                else if (row['Category']) catDisplay = row['Category'];
                const watchers = (formatLower === 'auction' && row['Watch Count'] && parseInt(row['Watch Count']) >= 1) ? `${row['Watch Count']}` : '';
                const comingSoonSelected = $('#filterForm input[type=checkbox][name=filter][value=coming_soon]:checked').length > 0;
                let formatDisplay = '';
                if (row['isScheduled']) {
                    if (formatLower === 'bin' || formatLower === 'fixedprice') {
                        formatDisplay = 'Buy It Now';
                    } else if (formatLower === 'auction') {
                        formatDisplay = 'Auction';
                    } else {
                        formatDisplay = row['Format'] || '';
                    }
                } else {
                    if (formatLower === 'bin' || formatLower === 'fixedprice') {
                        formatDisplay = 'Buy It Now';
                    } else {
                        formatDisplay = row['Format'] || '';
                    }
                }
                // Render action button when an eBay listing URL exists.
                // Button text depends on the selling format:
                //  - Auction -> "Place Bid Now"
                //  - BIN / Buy It Now -> "Buy It Now"
                //  - Coming Soon -> "Pre-Sale Purchase"
                let actionButtonHtml = '';
                const btnLinkRaw = row['ebay listing URL'] || '';
                const formatLowerInner = row['Format'] ? String(row['Format']).trim().toLowerCase() : '';
                if (btnLinkRaw) {
                    let btnLink = appendAffiliate(btnLinkRaw);
                    let buttonText = 'Buy It Now';
                    if (row['isScheduled']) {
                        let buttonColor = '#1d2731'; // Default dark color
                        if (formatLowerInner === 'auction') {
                            buttonColor = '#1d2731'; // Dark color for upcoming auctions
                            buttonText = 'Make Offer Now';
                            if (window.siteConfig && window.siteConfig["Card Button"] && window.siteConfig["Card Button"].upcoming_auctions === true) {
                                actionButtonHtml = `<button class="btn btn-primary mt-2" style="height: 55px; background-color: ${buttonColor} !important; color: white !important; font-size: 18px !important; border: none !important; font-weight: 600 !important;" onclick="openMakeOfferForm('${row['ItemID']}')">${buttonText}</button>`;
                            }
                        } else if (formatLowerInner === 'bin' || formatLowerInner === 'fixedprice') {
                            btnLink = row['PayPal Link'] || btnLink;
                            buttonText = 'Buy Early on PayPal';
                            if (window.siteConfig && window.siteConfig["Card Button"] && window.siteConfig["Card Button"].coming_soon === true) {
                                actionButtonHtml = `<button class="btn btn-primary mt-2" style="height: 55px; background-color: ${buttonColor} !important; color: white !important; font-size: 18px !important; border: none !important; font-weight: 600 !important;" onclick="window.open('${btnLink}', '_blank')">${buttonText}</button>`;
                            }
                        } else {
                            buttonText = 'Make Offer Now';
                            actionButtonHtml = `<button class="btn btn-primary mt-2" style="height: 55px; background-color: ${buttonColor} !important; color: white !important; font-size: 18px !important; border: none !important; font-weight: 600 !important;" onclick="openMakeOfferForm('${row['ItemID']}')">${buttonText}</button>`;
                        }
                    } else {
                        if (formatLowerInner === 'auction' || formatLowerInner.includes('auction')) {
                            buttonText = 'Bid Now on eBay';
                        } else if (formatLowerInner === 'bin' || formatLowerInner.includes('buy')) {
                            buttonText = 'Buy Now on eBay';
                        }
                        actionButtonHtml = `<button class="btn btn-primary mt-2" style="height: 55px; background-color: #0d6efd !important; color: white !important; font-size: 18px !important; border: none !important; font-weight: 600 !important;" onclick="window.open('${btnLink}', '_blank')">${buttonText}</button>`;
                    }
                }
                html += `
<div class="listing-card"${row['isScheduled'] ? ' style="position:relative;"' : ''}>
    ${(row['isScheduled'] && !(formatLower === 'bin' || formatLower === 'fixedprice' || formatLower === 'auction')) ? '<i class="fa-solid fa-info-circle" style="position:absolute; top:10px; right:10px; color:#fff; font-size:1.2em; z-index:10; background:rgba(0,0,0,0.7); padding:2px; border-radius:50%;"></i>' : ''}
  <div class="card-top">
    <div class="image-container" ${row['isScheduled'] ? 'style="position: relative;"' : (!row['isScheduled'] && (formatLower === 'bin' || formatLower === 'auction')) ? 'style="position: relative;"' : ''}>
      ${(!row['isScheduled'] && (formatLower === 'bin' || formatLower === 'auction')) ? `<a href="${link}" target="_blank" rel="noopener">` : ''}
      <img class="lazy-img" loading="lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" data-src="${imgUrl}" alt="${title}" ${row['isScheduled'] ? `onclick="openImageGallery('${row['ItemID']}')" title="Click To View Card" style="cursor: pointer;"` : `title="Click to View on eBay"`}>
      ${row['isScheduled'] ? `<a href="javascript:void(0)" onclick="openImageGallery('${row['ItemID']}')" style="position:absolute; top:10px; right:10px; z-index:10;" title="Click To View Card"></a>` : ''}
      ${(!row['isScheduled'] && (formatLower === 'bin' || formatLower === 'auction')) ? `</a>` : ''}
      <small style="color: #999; text-align: center; width: 100%;">eBay Item ID: ${itemNum}</small>
    </div>
    <div class="card-body">
      ${(!row['isScheduled'] && (formatLower === 'bin' || formatLower === 'auction')) ? `<a href="${link}" target="_blank" rel="noopener" style="text-decoration: none; color: inherit;">` : ''}
      <h6>${title}</h6>
      ${(!row['isScheduled'] && (formatLower === 'bin' || formatLower === 'auction')) ? `</a>` : ''}
      ${(formatLower !== 'auction' || (rawCat !== 'lots' && rawCat !== 'sets')) ? `<p class="mb-1">${row['Player/Athlete'] ? `<strong>Player:</strong> ${row['Player/Athlete']}<br>` : ''}${row['Team'] ? `<strong>Team:</strong> ${row['Team']}<br>` : ''}` : ''}
      <strong>Card:</strong> #${row['Card Number'] || ''}<br>
      <strong>Features:</strong> ${row['Features'] || ''}<br>
      <strong>Format:</strong> ${formatDisplay}<br>
      <strong>Category:</strong> ${catDisplay}<br>
      <strong>${quantityLabel}</strong> ${quantityValue}</p>
      <p class="price">${price} <span class="shipping-text">${shipping}</span></p>
      ${(upcomingAuctionsSelected || comingSoonSelected || row['isScheduled']) ? `<p class="start-date">Start Date: <span class="start-date-time">${new Date(row['Start Date']).toLocaleDateString('en-US', {month: '2-digit', day: '2-digit'})} ${new Date(row['Start Date']).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit', hour12: true, timeZoneName: 'short'})}</span></p>` : ''}
      ${!row['isScheduled'] && formatLower === 'auction' ?
                        `<p class="bid-info mb-1">${bids} <span class="auction-time">${displayTime}</span></p>
         <p class="bid-info mb-2">${row['Watch Count'] && parseInt(row['Watch Count']) > 0 ? `${row['Watch Count']} Watching` : '0 Watching'}</p>` :
                        !row['isScheduled'] && formatLower !== 'auction' ? `<p class="bid-info mb-2">${bids}</p>` : ''
                    }
    </div>
  </div>
  ${actionButtonHtml}
</div>
                `;

            });
            html += '</div>';
            $('#itemsGrid').html(html);
        }
        function filterData(data) {
            const selected = $('#filterForm input[type=checkbox][name=filter]:checked').map(function () { return this.value; }).get();
            const selectedCategories = $('#filterForm input[type=checkbox][name=category_filter]:checked').map(function () { return this.value; }).get();
            const selectedSports = $('#filterForm input[type=checkbox][name=sport_filter]:checked').map(function () { return this.value; }).get();
            const keyword = $('#keywordSearch').val().trim().toLowerCase();

            // If keyword is present, search all data (both active and scheduled)
            // Otherwise, filter by scheduled/active status based on format filters
            let filteredData = data;
            if (!keyword) {
                if (selected.includes('coming_soon') || selected.includes('upcoming_auctions')) {
                    filteredData = data.filter(row => row['isScheduled']);
                    // For "coming_soon", further filter to only BIN format
                    if (selected.includes('coming_soon')) {
                        filteredData = filteredData.filter(row => row['Format'] && (row['Format'].toLowerCase() === 'bin' || row['Format'].toLowerCase() === 'fixedprice'));
                    }
                    // For "upcoming_auctions", further filter to only auction format
                    if (selected.includes('upcoming_auctions')) {
                        filteredData = filteredData.filter(row => row['Format'] && row['Format'].toLowerCase() === 'auction');
                    }
                } else {
                    filteredData = data.filter(row => !row['isScheduled']);
                }
            }

            if (!selected.length && !selectedCategories.length && !selectedSports.length && !keyword) return filteredData;

            return filteredData.filter(row => {
                if (keyword) {
                    let found = false;
                    const fields = ['Title', 'Player/Athlete', 'Team', 'Card Name', 'Features', 'Attributes', 'Category', 'Sport', 'Current Price', 'ItemID', 'Format'];
                    for (let f of fields) {
                        if (row[f] && String(row[f]).toLowerCase().includes(keyword)) { found = true; break; }
                    }
                    if (!found) return false;
                }
                for (let filter of selected) {
                    if (filter === 'rookie') {
                        if (!((row['Features'] && row['Features'].toLowerCase().includes('rookie')) || (row['Card Name'] && row['Card Name'].toLowerCase().includes('rookie')))) return false;
                    } else if (filter === 'hof') {
                        if (!(row['Attributes'] && row['Attributes'].toLowerCase().includes('hall of fame'))) return false;
                    } else if (filter === 'uer') {
                        if (!(row['Card Name'] && row['Card Name'].trim().endsWith('UER'))) return false;
                    } else if (filter === 'err') {
                        if (!(row['Card Name'] && row['Card Name'].trim().endsWith('ERR'))) return false;
                    } else if (filter === 'cor') {
                        if (!(row['Card Name'] && row['Card Name'].trim().endsWith('COR'))) return false;
                    } else if (filter === 'graded') {
                        if (!(row['Graded'] && row['Graded'].toLowerCase() === 'yes')) return false;
                    } else if (filter === 'autographed') {
                        if (!(row['Autographed'] && row['Autographed'].toLowerCase() === 'yes')) return false;
                    } else if (filter === 'auction') {
                        if (!(row['Format'] && row['Format'].toLowerCase() === 'auction')) return false;
                    } else if (filter === 'bin') {
                        if (!(row['Format'] && (row['Format'].toLowerCase() === 'bin' || row['Format'].toLowerCase() === 'fixedprice'))) return false;
                    }
                }
                if (selectedCategories.length) {
                    let cat = (row['Category'] || '').trim().toLowerCase();
                    let found = false;
                    for (let catVal of selectedCategories) {
                        let val = catVal.trim().toLowerCase();
                        if (cat === val) { found = true; break; }
                    }
                    if (!found) return false;
                }
                if (selectedSports.length) {
                    let sport = (row['Sport'] || '').toLowerCase();
                    let found = false;
                    for (let sportVal of selectedSports) {
                        let val = sportVal.toLowerCase();
                        if (sport === val) { found = true; break; }
                    }
                    if (!found) return false;
                }
                return true;
            });
        }

        // Function to shuffle array in place (Fisher-Yates shuffle)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Load configuration and apply feature toggles
        $.getJSON('static/config/config.json?t=' + Date.now(), function (config) {
            // Store config globally for use in renderList
            window.siteConfig = config;
        }).fail(function() {
            console.error('Failed to load config.json');
            window.siteConfig = { "Card Button": { "upcoming_auctions": true, "coming_soon": true } }; // fallback
        }).always(function() {
            // Now load the data
            $.getJSON('data/ebay_active_items.json?t=' + Date.now(), function (activeItemsData) {
                $.getJSON('data/ebay_scheduled_items.json?t=' + Date.now(), function (scheduledData) {
                    // Combine active and scheduled data
                    const data = [...activeItemsData, ...scheduledData.map(item => ({ ...item, isScheduled: true }))];

                    // Randomize the order of cards
                    shuffleArray(data);

                window._ebayData = data;
                if (!data.length) {
                    $('#itemsGrid').html('<div>No data found.</div>');
                    updateResultsCount(0);
                    return;
                }
                $('#listViewBtn').addClass('active');
                $('#gridViewBtn').remove();
                // Default to showing active items
                const activeData = data.filter(row => !row['isScheduled']);
                renderList(activeData);
                updateResultsCount(activeData.length);
                function updateFilters() {
                    let filtered = filterData(data);
                    const selectedViews = $('#filterForm input[type=radio][name=view_filter]:checked').map(function () { return this.value; }).get();
                    if (selectedViews.length > 0) {
                        const sortBy = selectedViews[0]; // take the first one
                        if (sortBy === 'most_bids') {
                            filtered = filtered.filter(item => {
                                const bids = parseInt(item['Bid Count'] || 0);
                                return bids > 0;
                            });
                        } else if (sortBy === 'most_watchers') {
                            filtered = filtered.filter(item => {
                                const watchers = parseInt(item['Watch Count'] || 0);
                                return watchers >= 1;
                            });
                        } else if (sortBy === 'ending_today') {
                            const today = new Date();
                            const todayStr = today.toDateString();
                            filtered = filtered.filter(item => {
                                const endDate = new Date(item['End Date']);
                                return endDate.toDateString() === todayStr;
                            });
                        } else if (sortBy === 'ending_soonest') {
                            filtered = filtered.filter(item => {
                                return item['Format'] === 'Auction' && !item['isScheduled'];
                            });
                        }
                        filtered.sort((a, b) => {
                            if (sortBy === 'most_bids') {
                                const aBids = parseInt(a['Bid Count'] || 0);
                                const bBids = parseInt(b['Bid Count'] || 0);
                                return bBids - aBids;
                            } else if (sortBy === 'ending_soonest') {
                                const aDate = new Date(a['End Date']);
                                const bDate = new Date(b['End Date']);
                                return aDate - bDate;
                            } else if (sortBy === 'most_recent') {
                                // Assuming higher ItemID is more recent
                                const aId = parseInt(a['ItemID'] || 0);
                                const bId = parseInt(b['ItemID'] || 0);
                                return bId - aId;
                            } else if (sortBy === 'highest_price') {
                                const aPrice = parseFloat(a['Current Price'] || 0);
                                const bPrice = parseFloat(b['Current Price'] || 0);
                                return bPrice - aPrice;
                            } else if (sortBy === 'lowest_price') {
                                const aPrice = parseFloat(a['Current Price'] || 0);
                                const bPrice = parseFloat(b['Current Price'] || 0);
                                return aPrice - bPrice;
                            } else if (sortBy === 'most_watchers') {
                                const aWatchers = parseInt(a['Watch Count'] || 0);
                                const bWatchers = parseInt(b['Watch Count'] || 0);
                                return bWatchers - aWatchers;
                            } else if (sortBy === 'ending_today') {
                                const aDate = new Date(a['End Date']);
                                const bDate = new Date(b['End Date']);
                                return aDate - bDate;
                            }
                            return 0;
                        });
                    }
                    updateResultsCount(filtered.length);
                    renderList(filtered);
                }
                $('#filterForm input[type=checkbox][name=filter]').on('change', function () {
                    const val = $(this).val();
                    if ($(this).is(':checked') && ['auction', 'bin', 'coming_soon', 'upcoming_auctions'].includes(val)) {
                        // Uncheck the other three
                        const others = ['auction', 'bin', 'coming_soon', 'upcoming_auctions'].filter(v => v !== val);
                        others.forEach(otherVal => {
                            $(`#filterForm input[type=checkbox][name=filter][value="${otherVal}"]`).prop('checked', false);
                        });
                    }
                    // Sync mobile filters
                    $(`#mobileFormatFilters input[type=checkbox][name=filter][value="${val}"]`).prop('checked', $(this).is(':checked'));
                    updateFilters();
                });
                // Mobile filter change handlers
                $('#mobileFormatFilters input[type=checkbox][name=filter]').on('change', function () {
                    const val = $(this).val();
                    if ($(this).is(':checked') && ['auction', 'bin', 'coming_soon', 'upcoming_auctions'].includes(val)) {
                        // Uncheck the other three in mobile
                        const others = ['auction', 'bin', 'coming_soon', 'upcoming_auctions'].filter(v => v !== val);
                        others.forEach(otherVal => {
                            $(`#mobileFormatFilters input[type=checkbox][name=filter][value="${otherVal}"]`).prop('checked', false);
                        });
                        // Uncheck in sidebar
                        others.forEach(otherVal => {
                            $(`#filterForm input[type=checkbox][name=filter][value="${otherVal}"]`).prop('checked', false);
                        });
                    }
                    // Sync sidebar filters
                    $(`#filterForm input[type=checkbox][name=filter][value="${val}"]`).prop('checked', $(this).is(':checked'));
                    updateFilters();
                });
                // Mobile reset button
                $('#mobileResetBtn').on('click', function() {
                    $('#mobileFormatFilters input[type=checkbox][name=filter]').prop('checked', false);
                    $('#filterForm input[type=checkbox][name=filter]').prop('checked', false);
                    updateFilters();
                });
                $('#filterForm input[type=checkbox][name=category_filter]').on('change', updateFilters);
                $('#filterForm input[type=checkbox][name=sport_filter]').on('change', updateFilters);
                $('#filterForm input[type=radio][name=view_filter]').on('change', updateFilters);
                function updateClearBtn() {
                    const val = $('#keywordSearch').val();
                    if (val) {
                        $('#clearSearchBtn').show();
                    } else {
                        $('#clearSearchBtn').hide();
                    }
                }
                $('#keywordSearch').on('input', function () {
                    updateFilters();
                    updateClearBtn();
                });
                $('#clearSearchBtn').on('click', function () {
                    $('#keywordSearch').val('');
                    updateFilters();
                    updateClearBtn();
                    $('#keywordSearch').focus();
                });
                updateClearBtn();
                $('#clearAllFilters').on('click', function () {
                    $('#filterForm input[type=checkbox][name=filter]').prop('checked', false);
                    $('#mobileFormatFilters input[type=checkbox][name=filter]').prop('checked', false);
                    $('#filterForm input[type=checkbox][name=category_filter]').prop('checked', false);
                    $('#filterForm input[type=checkbox][name=sport_filter]').prop('checked', false);
                    $('#filterForm input[type=radio][name=view_filter]').prop('checked', false);
                    $('#keywordSearch').val('');
                    updateClearBtn();
                    // Show active items when all filters are cleared
                    const activeData = data.filter(row => !row['isScheduled']);
                    updateResultsCount(activeData.length);
                    renderList(activeData);
                });
            });
        });
    });

        // Improved lazy loading for images: always observe after DOM update
        (function () {
            let observer;
            function createObserver() {
                if (observer) observer.disconnect();
                observer = new window.IntersectionObserver((entries, obs) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            if (img.dataset.src && img.src !== img.dataset.src) {
                                img.src = img.dataset.src;
                            }
                            obs.unobserve(img);
                        }
                    });
                }, { rootMargin: '350px' }); // Increased for earlier loading
            }
            function observeImages() {
                if (!observer) createObserver();
                document.querySelectorAll('img.lazy-img').forEach(img => {
                    if (img.dataset.src && img.src !== img.dataset.src) {
                        observer.observe(img);
                    }
                });
            }
            // Patch renderList to always observe images after DOM update
            const origRenderList = renderList;
            renderList = function (items) {
                window.currentItems = items; // Store current items for modal access
                origRenderList(items);
                setTimeout(observeImages, 0); // Ensure DOM is updated
            };
            document.addEventListener('DOMContentLoaded', function () {
                createObserver();
                observeImages();
            });
        })();
    </script>
    <div class="custom-footer">

        <div style="display:flex;justify-content:center;align-items:center;gap:0;flex-wrap:wrap;margin-bottom:6px;">
            <a href="https://www.ebay.com/sch/i.html?rt=nc&_ssn=geeksportscardsandcollectables&_dmd=2&mkcid=1&mkrid=711-53200-19255-0&siteid=0&campid=5339025312&customid=&toolid=10001"
                target=_blank"
                style="color:#fff;text-decoration:none;display:flex;align-items:center;gap:6px;font-size:1em;"><i
                    class="fa-brands fa-ebay fa-xl" style="font-size:2em;"></i></a>
            <span style="color:#fff;font-size:1.3em;padding:0 16px;">|</span>
            <a href="#"
                style="color:#fff;text-decoration:none;display:flex;align-items:center;gap:6px;font-size:1em;"><i
                    class="fas fa-shipping-fast"></i> Shipping</a>
            <span style="color:#fff;font-size:1.3em;padding:0 16px;">|</span>
            <a href="#"
                style="color:#fff;text-decoration:none;display:flex;align-items:center;gap:6px;font-size:1em;"><i
                    class="fas fa-info-circle"></i> About</a>
        </div>
        <div>
            <p style="font-weight:bold;color:#fff;font-size:0.80em;margin:10px 0 0 0;">


                <a href="https://www.ebay.com/sch/i.html?rt=nc&_ssn=geeksportscardsandcollectables&_dmd=2&mkcid=1&mkrid=711-53200-19255-0&siteid=0&campid=5339025312&customid=&toolid=10001&LH_Auction=1"
                    target="_blank" style="text-decoration:none;font-weight:bold;">
                    <span style="color:#ffff;">AUCTION</span>
                </a> |


                <a href="https://www.ebay.com/sch/i.html?rt=nc&_ssn=geeksportscardsandcollectables&_dmd=2&mkcid=1&mkrid=711-53200-19255-0&siteid=0&campid=5339025312&customid=&toolid=10001&LH_BIN=1"
                    target="_blank" style="text-decoration:none;font-weight:bold;">
                    <span style="color:#ffff;">BUY IT NOW</span>
                </a> |

                <a href="#" style="text-decoration:none;font-weight:bold;">
                    <span style="color:#ffff;">SLABS</span>
                </a> |
                <a href="#" style="text-decoration:none;font-weight:bold;">
                    <span style="color:#ffff;">COLLECTABLES</span>
                </a>
            </p>
        </div>
        <div class="footer-social-icons">
            <a href="https://www.facebook.com/geeksportscards" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-facebook fa-xl"></i>
            </a>
            <a href="https://www.linkedin.com/company/geek-sports-cards" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-linkedin fa-xl"></i>
            </a>
            <a href="https://www.instagram.com/geek_sports_cards/" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-instagram fa-xl"></i>
            </a>
            <a href="mailto:info@geeksportscards.com" title="Email info@geeksportscards.com">
                <i class="fa-solid fa-envelope" style="font-size:1.40em; padding-top:2px;"></i>
            </a>
        </div>

        <span style="display:block;font-size:0.80em;margin-top:2px;">&copy; 2025 Geek Sports Cards and
            Collectables</span>
        <button id="backToTopBtn" aria-label="Back to Top" type="button"><i class="fas fa-arrow-up"
                style="font-size:1.1em;color:#fff;"></i></button>
    </div>

    <!-- Image Gallery Modal -->
    <div class="modal fade" id="imageGalleryModal" tabindex="-1" aria-labelledby="imageGalleryModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageGalleryModalLabel" style="font-weight: 600; text-align: center; width: 100%;">Card Images</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex gap-3">
                    <div id="thumbnailContainerWrapper" class="d-flex flex-column" style="max-width: 120px;">
                        <button id="scrollUpBtn" class="btn btn-sm btn-outline-secondary mb-1 d-none" style="width: 100%; font-size: 0.8em;" title="Scroll Up">
                            <i class="fas fa-chevron-up"></i>
                        </button>
                        <div id="thumbnailContainer" class="d-flex flex-column gap-2" style="max-height: 300px; overflow-y: auto;">
                            <!-- Thumbnails will be populated here -->
                        </div>
                        <button id="scrollDownBtn" class="btn btn-sm btn-outline-secondary mt-1 d-none" style="width: 100%; font-size: 0.8em;" title="Scroll Down">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                    <div id="mainImageContainer" class="flex-grow-1 text-center">
                        <img id="mainImage" src="" alt="Main Image" class="img-fluid d-block" style="max-height: 400px;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Make Offer Modal -->
    <div class="modal fade" id="makeOfferModal" tabindex="-1" aria-labelledby="makeOfferModalLabel">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="makeOfferModalLabel" style="font-weight: 600; text-align: center; width: 100%;">Make Offer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="makeOfferForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label">Name *</label>
                            <input type="text" class="form-control" id="contactName" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactEmail" class="form-label">Email *</label>
                            <input type="email" class="form-control" id="contactEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactPhone" class="form-label">Phone (optional)</label>
                            <input type="tel" class="form-control" id="contactPhone">
                        </div>
                        <div class="mb-3">
                            <label for="contactSubject" class="form-label">Subject</label>
                            <input type="text" class="form-control" id="contactSubject" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label">Message *</label>
                            <textarea class="form-control" id="contactMessage" rows="4" required placeholder="Please enter your offer or inquiry about this item..."></textarea>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary">Send Message</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Show back-to-top button when .custom-header is out of view
        (function () {
            function initBackToTop() {
                const header = document.querySelector('.custom-header');
                const btn = document.getElementById('backToTopBtn');
                if (!header || !btn) return;
                const io = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            btn.classList.remove('visible');
                        } else {
                            btn.classList.add('visible');
                        }
                    });
                }, { threshold: 0 });
                io.observe(header);
                function scrollToHeaderSmooth() {
                    try {
                        // Prefer scrolling the header into view for consistent placement
                        if (header && typeof header.scrollIntoView === 'function') {
                            header.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            return;
                        }
                    } catch (err) {
                        // fallback to scrolling to top if header unavailable
                    }
                    const scEl = document.scrollingElement || document.documentElement || document.body;
                    try {
                        if (scEl && typeof scEl.scrollTo === 'function') {
                            scEl.scrollTo({ top: 0, behavior: 'smooth' });
                            return;
                        }
                    } catch (err) {
                        // fall through to setting scrollTop
                    }
                    if (scEl) scEl.scrollTop = 0;
                    window.scrollTo(0, 0);
                }
                btn.addEventListener('click', function (e) {
                    // ensure default button behavior doesn't interfere
                    if (e && typeof e.preventDefault === 'function') e.preventDefault();
                    scrollToHeaderSmooth();
                });
                // keyboard accessibility (Enter / Space)
                btn.addEventListener('keydown', function (e) {
                    if (e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar') {
                        if (e && typeof e.preventDefault === 'function') e.preventDefault();
                        scrollToHeaderSmooth();
                    }
                });
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initBackToTop);
            } else {
                initBackToTop();
            }
        })();
        // Auto-scroll to top when the user scrolls past half the document height
        (function () {
            function initAutoScroll() {
                let autoTriggered = false;
                let lastScroll = 0;
                const resetThreshold = 50; // px from top to reset

                function onScroll() {
                    const scrollY = window.scrollY || window.pageYOffset;
                    const docHeight = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight);
                    const half = docHeight / 2;
                    const scrollingDown = scrollY > lastScroll;
                    lastScroll = scrollY;

                    if (!autoTriggered && scrollingDown && scrollY > half) {
                        autoTriggered = true;
                        // smooth scroll to top
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }

                    // reset so the auto-scroll can trigger again after user returns near top
                    if (autoTriggered && scrollY < resetThreshold) {
                        autoTriggered = false;
                    }
                }

                window.addEventListener('scroll', onScroll, { passive: true });
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initAutoScroll);
            } else {
                initAutoScroll();
            }
        })();
    </script>

    <script>
        // Ensure --footer-height CSS variable matches the rendered footer height.
        (function syncFooterHeightVar() {
            const footer = document.querySelector('.custom-footer');
            if (!footer) return;
            function setVar() {
                const h = footer.offsetHeight || 64;
                // set on the footer itself (fallback) and on :root for global use
                footer.style.setProperty('--footer-height', h + 'px');
                document.documentElement.style.setProperty('--footer-height', h + 'px');
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setVar);
            } else {
                setVar();
            }

            // Prefer ResizeObserver for precise updates; fall back to window resize
            if (window.ResizeObserver) {
                try {
                    const ro = new ResizeObserver(() => setVar());
                    ro.observe(footer);
                } catch (e) {
                    window.addEventListener('resize', setVar);
                }
            } else {
                window.addEventListener('resize', setVar);
            }
        })();
    </script>

    <script>
        // Handle make offer form submission
        document.getElementById('makeOfferForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('contactName').value;
            const email = document.getElementById('contactEmail').value;
            const phone = document.getElementById('contactPhone').value;
            const subject = document.getElementById('contactSubject').value;
            const message = document.getElementById('contactMessage').value;
            
            // Create mailto link with form data
            const body = `Name: ${name}\nEmail: ${email}\nPhone: ${phone}\n\nMessage:\n${message}`;
            const mailtoLink = `mailto:geeksportscards@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Open email client
            window.location.href = mailtoLink;
            
            // Close modal
            if (makeOfferModal) {
                makeOfferModal.hide();
            }
            
            // Reset form
            this.reset();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

</body>

</html>